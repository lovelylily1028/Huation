<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %> 
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<% 	String id = (String)session.getAttribute("user_id"); %>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>HUATION</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<link rel="stylesheet" href="/resources/css/ajax/BoardContentView.css">
		
		<script type="text/javascript">
			function editToggle(f){
				  if ($('#updateBtn').val() == 'ìˆ˜ì •'){
					  updateOpen(f);
					  $('#updateBtn').val('ì·¨ì†Œ')
				  }else {
					  updateClose(f)
					  $('#updateBtn').val('ìˆ˜ì •')
				  }
			}
			
			function updateOpen(){
				  $('#titleTemp').attr('readonly',false);
				  $('#contentTemp').attr('readonly',false);
				  
				  $('#titleTemp').css("border","3px solid red");
				  $('#contentTemp').css("border","3px solid red");
				
				  $('#updateSubmit').attr('type','button');
				  $('#file').attr('type','file');
			}

			function updateClose(){
				  $('#titleTemp').attr('readonly',true);
				  $('#contentTemp').attr('readonly',true);
				 
				  $('#titleTemp').css("border","none");
				  $('#contentTemp').css("border","none");
				  
				  $('#titleTemp').val ( $('#title').val() );
				  $('#contentTemp').val ( $('#contents').val() );
				  $('#file').attr('type','hidden');
				  
				  $('#updateSubmit').attr('type','hidden');
			}
			
			function cmtEditToggle(f){
				if ( $(f.commentToggle).val() == 'ìˆ˜ì •' ){
				
				$(f).css("border","3px solid red");
				$(f.contentTemp).attr("readonly",false)
				$(f.contentTemp).focus();
				$(f.commentHidden).attr("type","button")			
				$(f.commentToggle).val('ì·¨ì†Œ')
				
			}else {
				$(f.contentTemp).val( $(f.content).val() )
				
				$(f).css("border","1px solid #e8e8e8");
				$(f.contentTemp).attr("readonly",true)
				$(f.commentHidden).attr("type","hidden")
				$(f.commentToggle).val('ìˆ˜ì •')
			}
				
			function boardChange(){
				alert("Ajax ê²Œì‹œíŒì—ì„œëŠ” íŒŒì¼ë‹¤ìš´ë¡œë“œê°€ ë˜ì§€ì•ŠìŠµë‹ˆë‹¤.")
			}
					
		}
			
		</script>
	</head>
	<body>
			<%-- ê²Œì‹œê¸€ boardDto --%>
				<div class="contentInnerleft">
					<div class="subject">
					<input type="text" id="titleTemp" value="${map.boardDto.title}" readonly>
					</div>
					<div class="info">
						${map.boardDto.user_id }  |  ${map.boardDto.day }  | ì¡°íšŒìˆ˜: ${map.boardDto.hit }
					</div>
					<div class="commentBody">
					<textarea rows="15" cols="20" id="contentTemp" readonly>${map.boardDto.contents }</textarea>
					</div>
				</div>
					<div class="xright">
					<%-- ì²¨ë¶€íŒŒì¼ ë¶€ë¶„ --%>
					<c:choose>
			      		<c:when test="${map.boardDto.fileName ==null }">
							<span>ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</span>
			       		</c:when>
			    	 	<c:otherwise>
				       		<span> <a onclick="boardChange()">ì²¨ë¶€ëœ íŒŒì¼ :${map.boardDto.fileName }</a></span>
			    		</c:otherwise>
			        </c:choose>
			        </div>
			        <c:set var="id" value="<%=id %>"/>
					        
					        <%-- ê²Œì‹œë¬¼ ìˆ˜ì • / ì‚­ì œ --%>
					        <div class="xright">
					       		<c:if test="${id eq map.boardDto.user_id }">
					       			<form method="post" enctype="multipart/form-data" id="editForm">
					       				 <input type="hidden" id="user_id" name="user_id" value="<%= id %>">
										 <input type="hidden" id="bid" name="bid" value="${map.boardDto.bid }">
										 <input type="hidden" id="title" name="title" value="${map.boardDto.title }">
										 <input type="hidden" id="contents" name="contents" value="${map.boardDto.contents }">
										 <input type="hidden" id="fileName" name="fileName" value="${map.boardDto.fileName}">
										 <input type="hidden" name="rmt" id="rmt" value="edit">
											
										 <input type="hidden" id="file" name="file">

										<input type="hidden" id="updateSubmit" onclick="addChk(this.form,'${map.boardDto.bid}')" value="ìˆ˜ì •ì™„ë£Œ">
					       				<input type="button" id="updateBtn" value="ìˆ˜ì •" onclick="editToggle(this.form)">
					       				<input type="button" value="ì‚­ì œ" onclick="del('${map.boardDto.bid }')">
					       			</form>
						   		</c:if>
					        </div>
					        
					        <%-- ê²Œì‹œë¬¼ì— ë‹µê¸€ì„ ë‹¤ëŠ” ê²½ìš° --%>
						   	<c:if test="${not empty id }">
								<button type="button" onclick="add_view('${map.boardDto.bid}')">ë‹µê¸€ë‹¬ê¸°</button>
							</c:if>		
							<%-- ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ëŒì•„ê¸°ê¸°  --%>
			  					<button type="button" onclick="paging('${map.category}','${map.search}','${map.page }')"> ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° </button>
			<%-- ê²Œì‹œë¬¼ ë --%>
			 
			<%-- ëŒ“ê¸€ --%>
			 <h2>ëŒ“ê¸€</h2> 
			  <c:set var="user_id" value="<%=id%>"/>
			 
			 	<div class="subject">
					<%-- ëŒ“ê¸€ì´ ì—†ì„ ê²½ìš° --%>
					<c:if test="${empty cmap.clist }">
						<div># í˜„ì¬ ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
			 		</c:if>
					<%-- ëŒ“ê¸€ì´ ìˆëŠ” ê²½ìš° --%>	
					 <c:set var="list" value="${cmap.clist }"/>
					 <h4>${fn:length(list)}ê°œì˜ ëŒ“ê¸€ì´ ìˆìŠµë‹ˆë‹¤.</h4>
			 			<%-- ëŒ“ê¸€ clist ì¶œë ¥ ì‹œì‘ ë° ìˆ˜ì • Form --%>
						<c:forEach var="cdto" items="${cmap.clist }">
								<form class="commentBox" method="post" id="cmtEditForm">
									<input type="hidden" name="bid" value="${map.boardDto.bid }">
									<input type="hidden" name="cid" value="${cdto.cid }">
									<input type="hidden" name="content" value="${cdto.content }">
									<input type="hidden" name="crmt" value="edit">
									
									<div class="comment">
										<div>
											<span class="name">${cdto.user_id }</span>
											<span>${cdto.cdate }</span>
											<div class="commentBody">
												<textarea id="contentTemp" readonly>${cdto.content }</textarea>
											</div>
										</div>
										
										<%-- ë¡œê·¸ì¸ëœ ì•„ì´ë””ì™€ ì‘ì„±ìê°€ ê°™ì„ ê²½ìš° --%>
										<c:if test="${id eq cdto.user_id }">
											<div class="xright">
												<input type="hidden" id="commentHidden" onclick="cmtAdd(this.form,'${map.boardDto.bid}')" value="ìˆ˜ì •ì™„ë£Œ">
												<input type="button" id="commentToggle" onclick="cmtEditToggle(this.form)" value="ìˆ˜ì •">			        
												<button type="button" onclick="cmtDel('${map.boardDto.bid }','${cdto.cid}')">ì‚­ì œ</button>			        
											</div>
										</c:if>s
									</div>
								</form>
			 			</c:forEach>
			 			<%-- ëŒ“ê¸€ clist ì¶œë ¥ ë --%>
			 	</div>
			 	
			 	<%-- ëŒ“ê¸€ ì‘ì„± form --%> 
			 	<div style="margin-top:10px;">
			 		<form method="post" id="cmtAddForm">
			 			<input type="hidden" name="user_id" id="user_id" value="<%=id%>">
			 			<input type="hidden" name="bid" id="bid" value="${map.boardDto.bid }">
			 			<input type="hidden" name="content" id="content">
			 			<input type="hidden" name="crmt" value="add">
			 				<c:choose>
			 					<c:when test="<%=id == null%>">
									<div class="content">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.ğŸ˜‰ğŸ˜‰</div>
			 					</c:when>
			 					<c:otherwise>
			 						<div>
			 							<div class="name">
			 								<%= id %>
			 							</div>
			 							<div class="commentBody">
			 								<textarea rows="3" cols="10" id="contentTemp" name="contentTemp" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
			 							</div>
			 							<div class="xright">
								 			<input type="button" onclick="cmtAdd(this.form,'${map.boardDto.bid}')" value="ëŒ“ê¸€ ë“±ë¡í•˜ê¸°">
			 							</div>
			 						</div>
			 					</c:otherwise>
			 				</c:choose>
			 		</form>
			  	</div>    
				<%-- ëŒ“ê¸€ ì‘ì„± form ë --%>
	</body>
</html>