<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %> 
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<% 	String id = (String)session.getAttribute("user_id"); %>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>HUATION</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<link rel="stylesheet" href="/resources/css/BoardContentView.css">
		<script type="text/javascript" src="/resources/js/BoardCRUD.js"></script>
	</head>
	<body>
		<jsp:include page="../util/mainHeader.jsp"></jsp:include>
			<%-- ê²Œì‹œê¸€ boardDto --%>
			<h2>ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</h2>
				<div class="contentInnerleft">
					<div class="subject">
					<input type="text" id="titleTemp" value="${map.boardDto.title}" readonly>
					</div>
					<div class="info">
						${map.boardDto.user_id }  |  ${map.boardDto.day }  | ì¡°íšŒìˆ˜: ${map.boardDto.hit }
					</div>
					<div class="commentBody">
					<textarea rows="15" cols="10" id="contentTemp" readonly>${map.boardDto.contents }</textarea>
					</div>
				</div>
					<div class="xright">
					<%-- ì²¨ë¶€íŒŒì¼ ë¶€ë¶„ --%>
					<c:choose>
			      		<c:when test="${map.boardDto.fileName ==null }">
							<span>ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</span>
			       		</c:when>
			    	 	<c:otherwise>
				       		<span> <a href="/fileDown?bid=${map.boardDto.bid}">ì²¨ë¶€ëœ íŒŒì¼ :${map.boardDto.fileName }</a></span>
			    		</c:otherwise>
			        </c:choose>
			        </div>
			        <c:set var="id" value="<%=id %>"/>
					        
					        <%-- ê²Œì‹œë¬¼ ìˆ˜ì • / ì‚­ì œ --%>
					        <div class="xright">
					       		<c:if test="${id eq map.boardDto.user_id }">
					       			<form action="/board/edit" method="post" enctype="multipart/form-data" id="editForm">
					       				 <input type="hidden" id="user_id"name="user_id" id="user_id" value="<%= id %>">
										 <input type="hidden" id="bid" name="bid" value="${map.boardDto.bid }">
										 <input type="hidden" id="title" name="title" value="${map.boardDto.title }">
										 <input type="hidden" id="contents" name="contents" value="${map.boardDto.contents }">
										 <input type="hidden" id="fileName" name="fileName" value="${map.boardDto.fileName}">
											
										 <input type="hidden" id="file" name="file">

										<input type="hidden" id="updateSubmit" onclick="editCheck(this.form)" value="ìˆ˜ì •ì™„ë£Œ">
					       				<input type="button" id="updateBtn" value="ìˆ˜ì •" onclick="editToggle()">
					       				<input type="button" value="ì‚­ì œ" onclick="DeleteCheck(this.form)">
					       			</form>
						   		</c:if>
					        </div>
					        
					        <%-- ê²Œì‹œë¬¼ì— ë‹µê¸€ì„ ë‹¤ëŠ” ê²½ìš° --%>
						   	<c:if test="${not empty id }">
								<button type="button" onclick="boardCRUD('reply','${map.boardDto.bid}')">ë‹µê¸€ë‹¬ê¸°</button>
							</c:if>		
							<%-- ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ëŒì•„ê¸°ê¸°  --%>
			  					<button type="button" onclick="location.href='./list?category=${map.category}&page=${map.page }&search=${map.search }'"> ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° </button>
			<%-- ê²Œì‹œë¬¼ ë --%>
			 
			<%-- ëŒ“ê¸€ --%>
			 <h2>ëŒ“ê¸€</h2> 
			  <c:set var="user_id" value="<%=id%>"/>
			 
			 	<div class="subject">
					<%-- ëŒ“ê¸€ì´ ì—†ì„ ê²½ìš° --%>
					<c:if test="${empty cmap.clist }">
						<div># í˜„ì¬ ì‘ì„±ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
			 		</c:if>
					<%-- ëŒ“ê¸€ì´ ìˆëŠ” ê²½ìš° --%>	
					 <c:set var="list" value="${cmap.clist }"/>
					 <h4>${fn:length(list)}ê°œì˜ ëŒ“ê¸€ì´ ìˆìŠµë‹ˆë‹¤.</h4>
			 			<%-- ëŒ“ê¸€ clist ì¶œë ¥ ì‹œì‘ ë° ìˆ˜ì • Form --%>
						<c:forEach var="cdto" items="${cmap.clist }">
								<form class="commentBox" method="post" action="/board/commentEdit">
									<input type="hidden" name="bid" value="${map.boardDto.bid }">
									<input type="hidden" name="cid" value="${cdto.cid }">
									<input type="hidden" name="content" value="${cdto.content }">
									
									<div class="comment">
										<div>
											<span class="name">${cdto.user_id }</span>
											<span>${cdto.cdate }</span>
											<div class="commentBody">
												<textarea id="contentTemp" readonly>${cdto.content }</textarea>
											</div>
										</div>
										
										<%-- ë¡œê·¸ì¸ëœ ì•„ì´ë””ì™€ ì‘ì„±ìê°€ ê°™ì„ ê²½ìš° --%>
										<c:if test="${id eq cdto.user_id }">
											<div class="xright">
												<input type="hidden" id="commentHidden" onclick="commentCRUD('2',this.form)" value="ìˆ˜ì •ì™„ë£Œ">
												<input type="button" id="commentToggle" onclick="Edit(this.form)" value="ìˆ˜ì •">			        
												<button type="button"onclick="commentCRUD('3',this.form)">ì‚­ì œ</button>			        
											</div>
										</c:if>
									</div>
								</form>
			 			</c:forEach>
			 			<%-- ëŒ“ê¸€ clist ì¶œë ¥ ë --%>
			 	</div>
			 	
			 	<%-- ëŒ“ê¸€ ì‘ì„± form --%> 
			 	<div style="margin-top:10px;">
			 		<form action="/board/CommentCheck" method="post" name="commentForm">
			 			<input type="hidden" name="user_id" id="user_id" value="<%=id%>">
			 			<input type="hidden" name="bid" id="bid" value="${map.boardDto.bid }">
			 				<c:choose>
			 					<c:when test="<%=id == null%>">
									<div class="content">ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.ğŸ˜‰ğŸ˜‰</div>
			 					</c:when>
			 					<c:otherwise>
			 						<div>
			 							<div class="name">
			 								<%= id %>
			 							</div>
			 							<div class="commentBody">
			 								<textarea rows="3" cols="10" id="content" name="content" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea>
			 							</div>
			 							<div class="xright">
								 			<input type="button" onclick="commentCRUD('1',this.form)" value="ëŒ“ê¸€ ë“±ë¡í•˜ê¸°">
			 							</div>
			 						</div>
			 					</c:otherwise>
			 				</c:choose>
			 		</form>
			  	</div>    
				<%-- ëŒ“ê¸€ ì‘ì„± form ë --%>
		<jsp:include page="../util/mainFooter.jsp"></jsp:include>
	</body>
</html>